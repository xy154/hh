import{r as w,o as I,a as C,c as a,b as T,d as s,_ as N,e as p,f as J,F as f,g as h,u as $,h as l,t as n,n as D}from"./index-BsWyQQox.js";const U=()=>{setInterval(()=>{const m=JSON.parse(localStorage.getItem("orders")||"[]");if(m.length===0)return;const x=Date.now(),d=m.map(i=>{if([3,4,5].includes(i.status))return i;const g=new Date(i.createTime).getTime(),c=x-g;return i.status===1&&c>=120*1e3?{...i,status:2,statusUpdateTime:new Date().toLocaleString()}:i});localStorage.setItem("orders",JSON.stringify(d))},10*1e3)},L={class:"container",style:{"max-width":"1200px",margin:"0 auto",padding:"30px 0"}},z={key:0,style:{"text-align":"center",padding:"50px 0",color:"#999"}},A={style:{display:"flex","justify-content":"space-between","margin-bottom":"15px"}},V={style:{"margin-bottom":"15px","font-size":"14px",color:"#999"}},B=["src"],j={style:{flex:"1"}},F={style:{"font-size":"14px",color:"#666"}},E={style:{"font-size":"12px",color:"#999"}},G={style:{color:"#e63946","font-weight":"bold"}},M={style:{"margin-top":"15px"}},P={style:{"font-size":"16px","font-weight":"bold","margin-top":"10px"}},R={style:{"margin-top":"20px",display:"flex",gap:"10px","flex-wrap":"wrap"}},q=["onClick"],H=["onClick"],K=["onClick"],Q={key:2,style:{color:"#4299e1","line-height":"32px"}},W=["onClick"],X=["onClick"],Z={__name:"OrderList",setup(m){const x=$(),d=w([]);let i=null,g=null;I(()=>{c(),U(),k(),i=setInterval(c,5e3)}),C(()=>{clearInterval(i),clearInterval(g)});const c=()=>{try{const o=JSON.parse(localStorage.getItem("orders")||"[]"),r=Array.isArray(o)?o:[];d.value=r.sort((t,e)=>e.id-t.id||0)}catch{d.value=[],localStorage.setItem("orders","[]")}},b=o=>({0:"待付款",1:"待发货",2:"待收货",3:"已完成",4:"已取消",5:"未及时支付"})[o]||"未知状态",_=o=>({0:"#ff9800",1:"#4299e1",2:"#38b2ac",3:"#48bb78",4:"#ff4444",5:"#999"})[o]||"#333",y=(o,r)=>{try{const e=JSON.parse(localStorage.getItem("orders")||"[]").map(u=>u.id===o?{...u,status:r,statusUpdateTime:new Date().toLocaleString()}:u);localStorage.setItem("orders",JSON.stringify(e)),c(),alert(`订单状态已更新为：${b(r)}`)}catch{alert("操作失败，请重试！")}},O=o=>{if(confirm("确定要取消该订单吗？"))try{const t=JSON.parse(localStorage.getItem("orders")||"[]").map(e=>e.id===o?{...e,status:4,statusUpdateTime:new Date().toLocaleString()}:e);localStorage.setItem("orders",JSON.stringify(t)),c(),alert("订单已取消！")}catch{alert("取消失败，请重试！")}},S=o=>{if(confirm("确定要删除该订单吗？删除后不可恢复！"))try{const t=JSON.parse(localStorage.getItem("orders")||"[]").filter(e=>e.id!==o);localStorage.setItem("orders",JSON.stringify(t)),c(),alert("订单已删除！")}catch{alert("删除失败，请重试！")}},k=()=>{g=setInterval(()=>{try{const o=JSON.parse(localStorage.getItem("orders")||"[]"),r=Date.now(),t=o.map(e=>{if(e.status===0){const u=new Date(e.createTime).getTime();if(r-u>=60*1e3)return{...e,status:5,statusUpdateTime:new Date().toLocaleString()}}return e});localStorage.setItem("orders",JSON.stringify(t)),c()}catch{}},10*1e3)},v=()=>{x.push("/goods/list")};return(o,r)=>(l(),a("div",null,[T(N),s("div",L,[r[1]||(r[1]=s("h2",{style:{"font-size":"22px",color:"#555","margin-bottom":"20px"}},"我的订单",-1)),d.value.length===0?(l(),a("div",z,[r[0]||(r[0]=J(" 暂无订单~ ",-1)),s("button",{onClick:v,style:{"margin-left":"10px",padding:"8px 15px","background-color":"#8b5a2b",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}},"去购物")])):p("",!0),(l(!0),a(f,null,h(d.value,t=>(l(),a("div",{key:t.id,style:{border:"1px solid #eee","border-radius":"8px",padding:"20px","margin-bottom":"20px"}},[s("div",A,[s("span",null,"订单编号："+n(t.id),1),s("span",{style:D({color:_(t.status)})},n(b(t.status)),5)]),s("div",V," 最后状态更新："+n(t.statusUpdateTime||t.createTime),1),(l(!0),a(f,null,h(t.goods,e=>(l(),a("div",{key:e.id,style:{display:"flex","align-items":"center","margin-bottom":"10px","padding-bottom":"10px","border-bottom":"1px dashed #eee"}},[s("img",{src:`/assets/${e.img}`,style:{width:"60px",height:"60px","object-fit":"cover","margin-right":"15px","border-radius":"4px"}},null,8,B),s("div",j,[s("p",null,n(e.name),1),s("p",F,"x"+n(e.count),1),s("p",E,n(e.spec?.temp||"常温")+" · "+n(e.spec?.sugar||"正常糖"),1)]),s("p",G,"¥"+n(e.price*e.count),1)]))),128)),s("div",M,[s("p",null,"收货人："+n(t.receiver),1),s("p",null,"联系电话："+n(t.phone),1),s("p",null,"收货地址："+n(t.address),1),s("p",P,"订单总价：¥"+n(t.totalPrice),1)]),s("div",R,[s("button",{onClick:e=>o.$router.push(`/order/${t.id}`),style:{padding:"8px 15px",background:"#48bb78",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}}," 查看详情 ",8,q),t.status===0?(l(),a("button",{key:0,onClick:e=>y(t.id,1),style:{padding:"8px 15px",background:"#8b5a2b",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}}," 确认付款 ",8,H)):p("",!0),t.status===0?(l(),a("button",{key:1,onClick:e=>O(t.id),style:{padding:"8px 15px",background:"#ff9800",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}}," 取消订单 ",8,K)):p("",!0),t.status===1?(l(),a("span",Q," 物流配送中 ")):p("",!0),t.status===2?(l(),a("button",{key:3,onClick:e=>y(t.id,3),style:{padding:"8px 15px",background:"#38b2ac",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}}," 确认收货 ",8,W)):p("",!0),t.status===3||t.status===4||t.status===5?(l(),a("button",{key:4,onClick:e=>S(t.id),style:{padding:"8px 15px",background:"#ff4444",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}}," 删除订单 ",8,X)):p("",!0)])]))),128))])]))}};export{Z as default};
